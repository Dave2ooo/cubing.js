"use strict";let e="warn";let t=0;function r(r){switch(e){case"error":throw new Error(r);case"warn":return t++,void(t<10&&t+1===10&&console.warn(r))}}function n(t){e=t}class AlgPart{}function o(e,t){return e.type===t}function a(e,t){return o(e,t)||r(`Expected "type": "${t}", saw "type": "${e.type}".`),e}function s(e){return"type"in e&&!o(e,"sequence")}function u(e){return"type"in e||r('Expected "unit", saw a value that was not an AlgPart.'),o(e,"sequence")&&r('Expected unit, saw "sequence".'),e}class Unit extends AlgPart{}class Move extends Unit{}class Annotation extends Unit{}class Container extends Unit{}class Sequence extends AlgPart{constructor(e){super(),this.nestedUnits=e,this.type="sequence";for(const t of e)u(t);Object.freeze(this.nestedUnits),Object.freeze(this)}}class Group extends Container{constructor(e,t=1){super(),this.nestedSequence=e,this.amount=t,this.type="group",Object.freeze(this)}}class Commutator extends Container{constructor(e,t,r=1){super(),this.A=e,this.B=t,this.amount=r,this.type="commutator",Object.freeze(this)}}class Conjugate extends Container{constructor(e,t,r=1){super(),this.A=e,this.B=t,this.amount=r,this.type="conjugate",Object.freeze(this)}}class Pause extends Move{constructor(){super(),this.type="pause",Object.freeze(this)}}class NewLine extends Annotation{constructor(){super(),this.type="newLine",Object.freeze(this)}}class CommentShort extends Annotation{constructor(e){super(),this.comment=e,this.type="commentShort",Object.freeze(this)}}class CommentLong extends Annotation{constructor(e){super(),this.comment=e,this.type="commentLong",Object.freeze(this)}}class BlockMove extends Move{constructor(e,t,r,n=1){if(super(),this.family=r,this.amount=n,this.type="blockMove",t&&(this.innerLayer=t,e&&(this.outerLayer=e)),e&&!t)throw new Error("Attempted to contruct block move with outer layer but no inner layer");Object.freeze(this)}}function i(e,t){return new BlockMove(void 0,void 0,e,t)}function c(e,t,r){return new BlockMove(void 0,e,t,r)}function l(e,t,r,n){return new BlockMove(e,t,r,n)}function m(e,t){var r,n,o,a;return new BlockMove(null!==(r=t.outerLayer)&&void 0!==r?r:e.outerLayer,null!==(n=t.innerLayer)&&void 0!==n?n:e.innerLayer,null!==(o=t.family)&&void 0!==o?o:e.family,null!==(a=t.amount)&&void 0!==a?a:e.amount)}function p(e,t,r=!1,n=0){const o=e.nestedUnits,a=o[o.length-1];if(r&&a&&(u=t,(s=a).family===u.family&&s.innerLayer===u.innerLayer&&s.outerLayer===u.outerLayer)){const r=e.nestedUnits.slice(0,o.length-1);let s=a.amount+t.amount;return n>1&&(s=(s%n+n)%n,2*s>n&&(s-=n)),0!==s&&r.push(m(a,{amount:s})),new Sequence(r)}return new Sequence([...o,t]);var s,u}function v(...e){return new Sequence(Array.prototype.concat.apply([],[...e].map(e=>e.nestedUnits)))}function h(e,t,r){switch(t.type){case"sequence":return a(t,"sequence"),e.traverseSequence(t,r);case"group":return a(t,"group"),e.traverseGroup(t,r);case"blockMove":return a(t,"blockMove"),e.traverseBlockMove(t,r);case"commutator":return a(t,"commutator"),e.traverseCommutator(t,r);case"conjugate":return a(t,"conjugate"),e.traverseConjugate(t,r);case"pause":return a(t,"pause"),e.traversePause(t,r);case"newLine":return a(t,"newLine"),e.traverseNewLine(t,r);case"commentShort":return a(t,"commentShort"),e.traverseCommentShort(t,r);case"commentLong":return a(t,"commentLong"),e.traverseCommentLong(t,r);default:throw new Error(`Unknown AlgPart type: ${t.type}`)}}class TraversalDownUp{traverse(e,t){return h(this,e,t)}traverseIntoUnit(e,t){return u(this.traverse(e,t))}}class TraversalUp extends TraversalDownUp{traverse(e){return h(this,e,void 0)}traverseIntoUnit(e){return u(this.traverse(e))}}function w(e){const t=Math.abs(e);let r="";return 1!==t&&(r+=String(t)),t!==e&&(r+="'"),r}function f(e){let t=e.family+w(e.amount);return void 0!==e.innerLayer&&(t=String(e.innerLayer)+t,void 0!==e.outerLayer&&(t=String(e.outerLayer)+"-"+t)),t}const g=new class Invert extends TraversalUp{traverseSequence(e){return new Sequence(e.nestedUnits.slice().reverse().map(e=>this.traverseIntoUnit(e)))}traverseGroup(e){return new Group(this.traverseSequence(e.nestedSequence),e.amount)}traverseBlockMove(e){return new BlockMove(e.outerLayer,e.innerLayer,e.family,-e.amount)}traverseCommutator(e){return new Commutator(e.B,e.A,e.amount)}traverseConjugate(e){return new Conjugate(e.A,this.traverseSequence(e.B),e.amount)}traversePause(e){return e}traverseNewLine(e){return e}traverseCommentShort(e){return e}traverseCommentLong(e){return e}},d=new class Expand extends TraversalUp{traverseSequence(e){return new Sequence(this.flattenSequenceOneLevel(e.nestedUnits.map(e=>this.traverse(e))))}traverseGroup(e){return this.repeat(this.flattenSequenceOneLevel([this.traverse(e.nestedSequence)]),e)}traverseBlockMove(e){return e}traverseCommutator(e){const t=this.traverseSequence(e.A),r=this.traverseSequence(e.B);let n=[];return n=n.concat(t,r,L(t),L(r)),this.repeat(this.flattenSequenceOneLevel(n),e)}traverseConjugate(e){const t=this.traverseSequence(e.A),r=this.traverseSequence(e.B);let n=[];return n=n.concat(t,r,L(t)),this.repeat(this.flattenSequenceOneLevel(n),e)}traversePause(e){return e}traverseNewLine(e){return e}traverseCommentShort(e){return e}traverseCommentLong(e){return e}flattenSequenceOneLevel(e){let t=[];for(const r of e)if(o(r,"sequence"))t=t.concat(r.nestedUnits);else{if(!s(r))throw new Error("expand() encountered an internal error. Did you pass in a valid Algorithm?");t.push(r)}return t}repeat(e,t){const r=Math.abs(t.amount);let n;n=-1===(t.amount>0?1:-1)?L(new Sequence(e)).nestedUnits:e;let o=[];for(let e=0;e<r;e++)o=o.concat(n);return new Sequence(o)}},x=new class StructureEquals extends TraversalDownUp{traverseSequence(e,t){if(s(t))return!1;const r=t;if(e.nestedUnits.length!==r.nestedUnits.length)return!1;for(let t=0;t<e.nestedUnits.length;t++)if(!this.traverse(e.nestedUnits[t],r.nestedUnits[t]))return!1;return!0}traverseGroup(e,t){return o(t,"group")&&this.traverse(e.nestedSequence,t.nestedSequence)}traverseBlockMove(e,t){return o(t,"blockMove")&&e.outerLayer===t.outerLayer&&e.innerLayer===t.innerLayer&&e.family===t.family&&e.amount===t.amount}traverseCommutator(e,t){return o(t,"commutator")&&this.traverse(e.A,t.A)&&this.traverse(e.B,t.B)}traverseConjugate(e,t){return o(t,"conjugate")&&this.traverse(e.A,t.A)&&this.traverse(e.B,t.B)}traversePause(e,t){return o(t,"pause")}traverseNewLine(e,t){return o(t,"newLine")}traverseCommentShort(e,t){return o(t,"commentShort")&&e.comment===t.comment}traverseCommentLong(e,t){return o(t,"commentLong")&&e.comment===t.comment}},y=new class CoalesceBaseMoves extends TraversalUp{traverseSequence(e){const t=[];for(const r of e.nestedUnits)if(o(r,"blockMove"))if(t.length>0){const e=t[t.length-1];if(o(e,"blockMove")&&this.sameBlock(e,r)){const n=e.amount+r.amount;t.pop(),0!==n&&t.push(new BlockMove(r.outerLayer,r.innerLayer,r.family,n))}else t.push(r)}else t.push(r);else t.push(this.traverseIntoUnit(r));return new Sequence(t)}traverseGroup(e){return e}traverseBlockMove(e){return e}traverseCommutator(e){return e}traverseConjugate(e){return e}traversePause(e){return e}traverseNewLine(e){return e}traverseCommentShort(e){return e}traverseCommentLong(e){return e}sameBlock(e,t){return e.outerLayer===t.outerLayer&&e.innerLayer===t.innerLayer&&e.family===t.family}},S=new class ToString extends TraversalUp{traverseSequence(e){let t="";if(e.nestedUnits.length>0){t+=this.traverse(e.nestedUnits[0]);for(let r=1;r<e.nestedUnits.length;r++)t+=this.spaceBetween(e.nestedUnits[r-1],e.nestedUnits[r]),t+=this.traverse(e.nestedUnits[r])}return t}traverseGroup(e){return"("+this.traverse(e.nestedSequence)+")"+w(e.amount)}traverseBlockMove(e){return f(e)}traverseCommutator(e){return"["+this.traverse(e.A)+", "+this.traverse(e.B)+"]"+w(e.amount)}traverseConjugate(e){return"["+this.traverse(e.A)+": "+this.traverse(e.B)+"]"+w(e.amount)}traversePause(e){return"."}traverseNewLine(e){return"\n"}traverseCommentShort(e){return"//"+e.comment}traverseCommentLong(e){return"/*"+e.comment+"*/"}spaceBetween(e,t){return o(e,"pause")&&o(t,"pause")||o(e,"newLine")||o(t,"newLine")?"":o(e,"commentShort")&&!o(t,"newLine")?"\n":" "}},L=g.traverseSequence.bind(g),A=d.traverseSequence.bind(d),C=x.traverseSequence.bind(x),q=y.traverseSequence.bind(y),U=S.traverseSequence.bind(S),M=(S.traverse.bind(S),S.traverse.bind(S));var B;function E(e){if("sequence"!==e.type)throw new Error(`Expected Sequence while parsing, got: ${e.type}`);if(!e.nestedUnits)throw new Error("Missing nestedUnits");return new Sequence(e.nestedUnits.map(e=>function(e){switch(e.type){case"sequence":throw new Error("Expected AlgPart while parsing, got `Sequence`.");case"group":if(!e.nestedSequence)throw new Error("Missing nestedSequence");if(!e.amount)throw new Error("Missing amount");return new Group(E(e.nestedSequence),e.amount);case"blockMove":if(!e.family)throw new Error("Missing family");if(!e.amount)throw new Error("Missing amount");return new BlockMove(e.outerLayer,e.innerLayer,e.family,e.amount);case"commutator":if(!e.A)throw new Error("Missing A");if(!e.B)throw new Error("Missing B");if(!e.amount)throw new Error("Missing amount");return new Commutator(E(e.A),E(e.B),e.amount);case"conjugate":if(!e.A)throw new Error("Missing A");if(!e.B)throw new Error("Missing B");if(!e.amount)throw new Error("Missing amount");return new Conjugate(E(e.A),E(e.B),e.amount);case"pause":return new Pause;case"newLine":return new NewLine;case"commentShort":if(!e.comment)throw new Error("Missing comment");return new CommentShort(e.comment);case"commentLong":if(!e.comment)throw new Error("Missing comment");return new CommentLong(e.comment);default:throw new Error(`Unknown alg type: ${e.type}`)}}(e)))}(B=exports.Example||(exports.Example={})).Sune=new Sequence([i("R",1),i("U",1),i("R",-1),i("U",1),i("R",1),i("U",-2),i("R",-1)]),B.AntiSune=new Sequence([i("R",1),i("U",2),i("R",-1),i("U",-1),i("R",1),i("U",-1),i("R",-1)]),B.SuneCommutator=new Sequence([new Commutator(new Sequence([i("R",1),i("U",1),i("R",-2)]),new Sequence([new Conjugate(new Sequence([i("R",1)]),new Sequence([i("U",1)]),1)]),1)]),B.Niklas=new Sequence([i("R",1),i("U",-1),i("L",-1),i("U",1),i("R",-1),i("U",-1),i("L",1),i("U",1)]),B.EPerm=new Sequence([i("x",-1),new Commutator(new Sequence([new Conjugate(new Sequence([i("R",1)]),new Sequence([i("U",-1)]))]),new Sequence([i("D",1)]),1),new Commutator(new Sequence([new Conjugate(new Sequence([i("R",1)]),new Sequence([i("U",1)]))]),new Sequence([i("D",1)]),1),i("x",1)]),B.FURURFCompact=new Sequence([new Conjugate(new Sequence([i("F",1)]),new Sequence([new Commutator(new Sequence([i("U",1)]),new Sequence([i("R",1)]),1)]),1)]),B.APermCompact=new Sequence([new Conjugate(new Sequence([i("R",2)]),new Sequence([new Commutator(new Sequence([i("F",2)]),new Sequence([i("R",-1),i("B",-1),i("R",1)]),1)]),1)]),B.FURURFMoves=new Sequence([i("F",1),i("U",1),i("R",1),i("U",-1),i("R",-1),i("F",-1)]),B.TPerm=new Sequence([i("R",1),i("U",1),i("R",-1),i("U",-1),i("R",-1),i("F",1),i("R",2),i("U",-1),i("R",-1),i("U",-1),i("R",1),i("U",1),i("R",-1),i("F",-1)]),B.HeadlightSwaps=new Sequence([new Conjugate(new Sequence([i("F",1)]),new Sequence([new Commutator(new Sequence([i("R",1)]),new Sequence([i("U",1)]),3)]),1)]),B.TriplePause=new Sequence([new Pause,new Pause,new Pause]),B.AllAlgParts=[new Sequence([i("R",1),i("U",-1)]),new Group(new Sequence([i("F",1)]),2),i("R",2),new Commutator(new Sequence([i("R",2)]),new Sequence([i("U",2)]),2),new Conjugate(new Sequence([i("L",2)]),new Sequence([i("D",-1)]),2),new Pause,new NewLine,new CommentShort("short comment"),new CommentLong("long comment")];class ValidationError extends Error{}class ValidatorTraversal extends TraversalUp{}function k(e,t){for(const r of t)if(!0===r[e])return!0;return!1}const R={x:!0,y:!0,z:!0,M:!0,E:!0,S:!0,m:!0,e:!0,s:!0},P={U:!0,L:!0,F:!0,R:!0,B:!0,D:!0},b={u:!0,l:!0,f:!0,r:!0,b:!0,d:!0,Uw:!0,Lw:!0,Fw:!0,Rw:!0,Bw:!0,Dw:!0};class BaseMoveValidator extends ValidatorTraversal{traverseSequence(e){for(const t of e.nestedUnits)this.traverse(t)}traverseGroup(e){return this.traverse(e.nestedSequence)}traverseCommutator(e){this.traverse(e.A),this.traverse(e.B)}traverseConjugate(e){this.traverse(e.A),this.traverse(e.B)}traversePause(e){}traverseNewLine(e){}traverseCommentShort(e){}traverseCommentLong(e){}}const j=new class BlockMoveValidator extends BaseMoveValidator{traverseBlockMove(e){if(void 0===e.outerLayer)if(void 0===e.innerLayer){if(!k(e.family,[b,P,R]))throw new ValidationError(`Invalid SiGN plain move family: ${e.family}`)}else{if(!k(e.family,[b,P]))throw new ValidationError(`The provided SiGN move family is invalid, or cannot have an inner slice: ${e.family}`);if(e.innerLayer<=0)throw new ValidationError("Cannot have an inner layer of 0 or less.")}else{if(void 0===e.innerLayer)throw new ValidationError("A BlockMove with an outer layer must have an inner layer.");if(!k(e.family,[b]))throw new ValidationError(`The provided SiGN move family is invalid, or cannot have an outer and inner layer: ${e.family}`);if(e.outerLayer<=0)throw new ValidationError("Cannot have an outer layer of 0 or less.");if(e.outerLayer>=e.innerLayer)throw new ValidationError("The outer layer must be less than the inner layer.")}}},T=j.traverse.bind(j),z=new class FlatAlgValidator extends ValidatorTraversal{traverseSequence(e){for(const t of e.nestedUnits)this.traverse(t)}traverseGroup(e){throw new ValidationError("A flat alg cannot contain a group.")}traverseBlockMove(e){}traverseCommutator(e){throw new ValidationError("A flat alg cannot contain a commutator.")}traverseConjugate(e){throw new ValidationError("A flat alg cannot contain a conjugate.")}traversePause(e){}traverseNewLine(e){}traverseCommentShort(e){}traverseCommentLong(e){}},F=z.traverse.bind(z);function N(e){T(e),F(e)}var G=function(){function e(t,r,n,o){this.message=t,this.expected=r,this.found=n,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+o(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function o(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}return"Expected "+function(e){var t,n,o,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=(o=e[t],r[o.type](o));if(a.sort(),a.length>0){for(t=1,n=1;t<a.length;t++)a[t-1]!==a[t]&&(a[n]=a[t],n++);a.length=n}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+o(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var n,o,a,s,u={},i={start:$},c=$,l=/^[0-9]/,m=G([["0","9"]],!1,!1),p=N("'",!1),v=/^[_A-Za-z]/,h=G(["_",["A","Z"],["a","z"]],!1,!1),w=N("-",!1),f=N("[",!1),g=/^[,:]/,d=G([",",":"],!1,!1),x=N("]",!1),y=N("(",!1),S=N(")",!1),L=N("//",!1),A=/^[^\n\r]/,C=G(["\n","\r"],!0,!1),q=N("/*",!1),U=/^[^*]/,M=G(["*"],!0,!1),B=N("*/",!1),E=/^[\n\r]/,k=G(["\n","\r"],!1,!1),R=N(".",!1),P=/^[ ]/,b=G([" "],!1,!1),j=0,T=[{line:1,column:1}],z=0,F=[];if("startRule"in r){if(!(r.startRule in i))throw new Error("Can't start parsing from rule \""+r.startRule+'".');c=i[r.startRule]}function N(e,t){return{type:"literal",text:e,ignoreCase:t}}function G(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function O(e){var r,n=T[e];if(n)return n;for(r=e-1;!T[r];)r--;for(n={line:(n=T[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return T[e]=n,n}function V(e,t){var r=O(e),n=O(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function D(e){j<z||(j>z&&(z=j,F=[]),F.push(e))}function $(){return W()}function I(){var e,r;if(j,e=[],l.test(t.charAt(j))?(r=t.charAt(j),j++):(r=u,D(m)),r!==u)for(;r!==u;)e.push(r),l.test(t.charAt(j))?(r=t.charAt(j),j++):(r=u,D(m));else e=u;return e!==u&&(e=parseInt(e.join(""),10)),e}function _(){var e,r;if(j,e=[],v.test(t.charAt(j))?(r=t.charAt(j),j++):(r=u,D(h)),r!==u)for(;r!==u;)e.push(r),v.test(t.charAt(j))?(r=t.charAt(j),j++):(r=u,D(h));else e=u;return e!==u&&(e=e.join("")),e}function Z(){var e,r,n,o,a,s;return(e=function(){var e,r,n,o,a;return e=j,(r=_())!==u&&(r={type:"blockMove",family:r}),(e=r)===u&&(e=j,(r=I())!==u&&(n=_())!==u?e=r=function(e,t){return{type:"blockMove",family:t,innerLayer:e}}(r,n):(j=e,e=u),e===u&&(e=j,(r=I())!==u?(45===t.charCodeAt(j)?(n="-",j++):(n=u,D(w)),n!==u&&(o=I())!==u&&(a=_())!==u?e=r=function(e,t,r){return{type:"blockMove",family:r,outerLayer:e,innerLayer:t}}(r,o,a):(j=e,e=u)):(j=e,e=u))),e}())===u&&(e=j,91===t.charCodeAt(j)?(r="[",j++):(r=u,D(f)),r!==u&&(n=W())!==u?(g.test(t.charAt(j))?(o=t.charAt(j),j++):(o=u,D(d)),o!==u&&(a=W())!==u?(93===t.charCodeAt(j)?(s="]",j++):(s=u,D(x)),s!==u?e=r={type:","===o?"commutator":"conjugate",A:n,B:a}:(j=e,e=u)):(j=e,e=u)):(j=e,e=u),e===u&&(e=j,40===t.charCodeAt(j)?(r="(",j++):(r=u,D(y)),r!==u&&(n=W())!==u?(41===t.charCodeAt(j)?(o=")",j++):(o=u,D(S)),o!==u?e=r={type:"group",nestedSequence:n}:(j=e,e=u)):(j=e,e=u))),e}function J(){var e,r,n,o,a;return e=j,(r=Z())!==u&&(n=function(){var e,r,n;return e=j,(r=I())!==u?(39===t.charCodeAt(j)?(n="'",j++):(n=u,D(p)),n!==u?e=r=-r:(j=e,e=u)):(j=e,e=u),e===u&&(e=I())===u&&(e=j,39===t.charCodeAt(j)?(r="'",j++):(r=u,D(p)),r!==u&&(r=-1),e=r),e}())!==u?(a=n,(o=r).amount=a,e=r=o):(j=e,e=u),e===u&&(e=j,(r=Z())!==u&&(r=function(e){return e.amount=1,e}(r)),e=r),e}function K(){var e,r;return e=j,E.test(t.charAt(j))?(r=t.charAt(j),j++):(r=u,D(k)),r!==u&&(r={type:"newLine"}),(e=r)===u&&(e=j,46===t.charCodeAt(j)?(r=".",j++):(r=u,D(R)),r!==u&&(r={type:"pause"}),(e=r)===u&&(e=function(){var e,r,n,o;if(e=j,"//"===t.substr(j,2)?(r="//",j+=2):(r=u,D(L)),r!==u){for(n=[],A.test(t.charAt(j))?(o=t.charAt(j),j++):(o=u,D(C));o!==u;)n.push(o),A.test(t.charAt(j))?(o=t.charAt(j),j++):(o=u,D(C));n!==u?e=r={type:"commentShort",comment:n.join("")}:(j=e,e=u)}else j=e,e=u;if(e===u)if(e=j,"/*"===t.substr(j,2)?(r="/*",j+=2):(r=u,D(q)),r!==u){for(n=[],U.test(t.charAt(j))?(o=t.charAt(j),j++):(o=u,D(M));o!==u;)n.push(o),U.test(t.charAt(j))?(o=t.charAt(j),j++):(o=u,D(M));n!==u?("*/"===t.substr(j,2)?(o="*/",j+=2):(o=u,D(B)),o!==u?e=r=function(e){return{type:"commentLong",comment:e.join("")}}(n):(j=e,e=u)):(j=e,e=u)}else j=e,e=u;return e}())),e}function H(){var e;return(e=J())===u&&(e=K()),e}function Q(){var e,t,r;return e=j,(t=H())!==u&&(r=Q())!==u?e=t=[t].concat(r):(j=e,e=u),e===u&&(e=j,(t=H())!==u&&(t=function(e){return[e]}(t)),e=t),e}function W(){var e,r,n,o,a;for(e=j,r=[],P.test(t.charAt(j))?(n=t.charAt(j),j++):(n=u,D(b));n!==u;)r.push(n),P.test(t.charAt(j))?(n=t.charAt(j),j++):(n=u,D(b));if(r!==u)if((n=function e(){var r,n,o,a,s;if(r=j,(n=Q())!==u){if(o=[],P.test(t.charAt(j))?(a=t.charAt(j),j++):(a=u,D(b)),a!==u)for(;a!==u;)o.push(a),P.test(t.charAt(j))?(a=t.charAt(j),j++):(a=u,D(b));else o=u;o!==u&&(a=e())!==u?(s=a,r=n=n.concat(s)):(j=r,r=u)}else j=r,r=u;return r===u&&(r=Q()),r}())!==u){for(o=[],P.test(t.charAt(j))?(a=t.charAt(j),j++):(a=u,D(b));a!==u;)o.push(a),P.test(t.charAt(j))?(a=t.charAt(j),j++):(a=u,D(b));o!==u?e=r={type:"sequence",nestedUnits:n}:(j=e,e=u)}else j=e,e=u;else j=e,e=u;if(e===u){for(e=j,r=[],P.test(t.charAt(j))?(n=t.charAt(j),j++):(n=u,D(b));n!==u;)r.push(n),P.test(t.charAt(j))?(n=t.charAt(j),j++):(n=u,D(b));r!==u&&(r={type:"sequence",nestedUnits:[]}),e=r}return e}if((n=c())!==u&&j===t.length)return n;throw n!==u&&j<t.length&&D({type:"end"}),o=F,a=z<t.length?t.charAt(z):null,s=z<t.length?V(z,z+1):V(z,z),new e(e.buildMessage(o,a),o,a,s)}}}();const{parse:O}=G;function V(e,t={validators:[]}){t.validators=t.validators||[];const r=E(O(e));for(const e of t.validators)e(r);return r}const D={73:i("R"),75:i("R",-1),87:i("B"),79:i("B",-1),83:i("D"),76:i("D",-1),68:i("L"),69:i("L",-1),74:i("U"),70:i("U",-1),72:i("F"),71:i("F",-1),78:i("F"),86:i("F",-1),67:i("l"),82:i("l",-1),85:i("r"),77:i("r",-1),84:i("x"),89:i("x"),66:i("x",-1),186:i("y"),59:i("y"),65:i("y",-1),80:i("z"),81:i("z",-1),190:i("M",-1)};function $(e){return e.altKey||e.ctrlKey?null:D[e.keyCode]||null}function I(e){let t=U(e);return t=t.replace(/_/g,"&#95;").replace(/ /g,"_"),t=t.replace(/\+/g,"&#2b;"),t=t.replace(/-/g,"&#45;").replace(/'/g,"-"),t}function _(e){let t=e;return t=t.replace(/-/g,"'").replace(/&#45;/g,"-"),t=t.replace(/\+/g," ").replace(/&#2b;/g,"+"),t=t.replace(/_/g," ").replace(/&#95;/g,"_"),V(t)}function Z(e){return _(new URLSearchParams(window.location.search).get(e)||"")}function J(e){const t=new URL("https://alg.cubing.net");if(!e.alg)throw new Error("An alg parameter is required.");if(t.searchParams.set("alg",I(e.alg)),e.setup&&t.searchParams.set("setup",I(e.setup)),e.title&&t.searchParams.set("title",e.title),e.puzzle){if(-1===["1x1x1","2x2x2","3x3x3","4x4x4","5x5x5","6x6x6","7x7x7","8x8x8","9x9x9","10x10x10","11x11x11","12x12x12","13x13x13","14x14x14","16x16x16","17x17x17"].indexOf(e.puzzle))throw new Error(`Invalid puzzle parameter: ${e.puzzle}`);t.searchParams.set("puzzle",e.puzzle)}if(e.stage){if(-1===["full","cross","F2L","LL","OLL","PLL","CLS","ELS","L6E","CMLL","WV","ZBLL","void"].indexOf(e.stage))throw new Error(`Invalid stage parameter: ${e.stage}`);t.searchParams.set("stage",e.stage)}if(e.view){if(-1===["editor","playback","fullscreen"].indexOf(e.view))throw new Error(`Invalid view parameter: ${e.view}`);t.searchParams.set("view",e.view)}if(e.type){if(-1===["moves","reconstruction","alg","reconstruction-end-with-setup"].indexOf(e.type))throw new Error(`Invalid type parameter: ${e.type}`);t.searchParams.set("type",e.type)}return t.toString()}var K=Object.freeze({__proto__:null,AlgPart:AlgPart,Unit:Unit,Move:Move,Container:Container,Annotation:Annotation,Sequence:Sequence,Group:Group,BlockMove:BlockMove,BareBlockMove:i,LayerBlockMove:c,RangeBlockMove:l,Commutator:Commutator,Conjugate:Conjugate,Pause:Pause,NewLine:NewLine,CommentShort:CommentShort,CommentLong:CommentLong,modifiedBlockMove:m,experimentalAppendBlockMove:p,experimentalConcatAlgs:v,TraversalDownUp:TraversalDownUp,TraversalUp:TraversalUp,invert:L,expand:A,structureEquals:C,coalesceBaseMoves:q,algToString:U,algPartToStringForTesting:M,blockMoveToString:f,get Example(){return exports.Example},fromJSON:E,parse:V,keyToMove:$,validateSiGNMoves:T,validateFlatAlg:F,validateSiGNAlg:N,ValidationError:ValidationError,serializeURLParam:I,deserializeURLParam:_,algCubingNetLink:J,getAlgURLParam:Z,setAlgPartTypeMismatchReportingLevel:n});exports.AlgPart=AlgPart,exports.Annotation=Annotation,exports.BareBlockMove=i,exports.BlockMove=BlockMove,exports.CommentLong=CommentLong,exports.CommentShort=CommentShort,exports.Commutator=Commutator,exports.Conjugate=Conjugate,exports.Container=Container,exports.Group=Group,exports.LayerBlockMove=c,exports.Move=Move,exports.NewLine=NewLine,exports.Pause=Pause,exports.RangeBlockMove=l,exports.Sequence=Sequence,exports.TraversalDownUp=TraversalDownUp,exports.TraversalUp=TraversalUp,exports.Unit=Unit,exports.ValidationError=ValidationError,exports.algCubingNetLink=J,exports.algPartToStringForTesting=M,exports.algToString=U,exports.blockMoveToString=f,exports.coalesceBaseMoves=q,exports.deserializeURLParam=_,exports.expand=A,exports.experimentalAppendBlockMove=p,exports.experimentalBlockMoveQuantumName=function(e){return M(new BlockMove(e.outerLayer,e.innerLayer,e.family,1))},exports.experimentalConcatAlgs=v,exports.fromJSON=E,exports.getAlgURLParam=Z,exports.index=K,exports.invert=L,exports.keyToMove=$,exports.modifiedBlockMove=m,exports.parse=V,exports.serializeURLParam=I,exports.setAlgPartTypeMismatchReportingLevel=n,exports.structureEquals=C,exports.validateFlatAlg=F,exports.validateSiGNAlg=N,exports.validateSiGNMoves=T;
//# sourceMappingURL=index-3df29a49.js.map
