"use strict";var e=require("./index-3df29a49.js"),t=require("three"),i=require("./index-3d2ac941.js");function s(e){return e*e*e*(10-e*(15-6*e))}const r=2*Math.PI,n="undefined"!=typeof window&&"ResizeObserver"in window;class Vantage{constructor(e,i,s={}){if(this.element=e,this.scene=i,this.rafID=null,this.stats=null,this.shift=0,this.camera=new t.PerspectiveCamera(20,e.offsetWidth/e.offsetHeight,.1,1e3),this.camera.position.copy(s.position?s.position:o),this.camera.lookAt(new t.Vector3(0,0,0)),this.renderer=new t.WebGLRenderer({antialias:!0,alpha:!0}),this.shift=s.shift?s.shift:0,this.resize(),this.render(),n){new window.ResizeObserver(this.resize.bind(this)).observe(this.element)}e.appendChild(this.renderer.domElement)}resize(){null===this.rafID&&(this.rafID=requestAnimationFrame(this.scheduledResize.bind(this)))}render(){this.stats&&this.stats.begin(),this.renderer.render(this.scene,this.camera),this.stats&&this.stats.end()}scheduledResize(){const e=this.element.offsetWidth,t=this.element.offsetHeight;let i=0;this.shift>0?i=Math.max(0,Math.floor(.5*(e-t))):this.shift<0&&(i=-Math.max(0,Math.floor(.5*(e-t))));let s=0,r=0;t>e&&(r=t-e,s=-Math.floor(.5*r)),this.camera.aspect=e/t,this.camera.setViewOffset(e,t-r,i,s,e,t),this.camera.updateProjectionMatrix(),this.renderer.setPixelRatio(devicePixelRatio||1),this.renderer.setSize(e,t,!1),this.render(),this.rafID=null}}const o=new t.Vector3(2,4,4);class Twisty3D{constructor(){this.vantages=[],this.scene=new t.Scene}newVantage(e,t){const i=new Vantage(e,this.scene,t);return this.vantages.push(i),i}draw(e){this.updateScene(e);for(const e of this.vantages)e.render()}experimentalGetScene(){return this.scene}experimentalGetVantages(){return this.vantages}}class AxisInfo{constructor(e,i,s){this.vector=e,this.fromZ=i,this.color=s,this.stickerMaterial=new t.MeshBasicMaterial({color:s,side:t.DoubleSide}),this.hintStickerMaterial=new t.MeshBasicMaterial({color:s,side:t.BackSide})}}const a=[new AxisInfo(new t.Vector3(0,1,0),new t.Euler(-r/4,0,0),16777215),new AxisInfo(new t.Vector3(-1,0,0),new t.Euler(0,-r/4,0),16746496),new AxisInfo(new t.Vector3(0,0,1),new t.Euler(0,0,0),65280),new AxisInfo(new t.Vector3(1,0,0),new t.Euler(0,r/4,0),16711680),new AxisInfo(new t.Vector3(0,0,-1),new t.Euler(0,r/2,0),255),new AxisInfo(new t.Vector3(0,-1,0),new t.Euler(r/4,0,0),16776960)],h={U:0,L:1,F:2,R:3,B:4,D:5},u={U:h.U,u:h.U,y:h.U,L:h.L,l:h.L,M:h.L,F:h.F,f:h.F,S:h.F,z:h.F,R:h.R,r:h.R,x:h.R,B:h.B,b:h.B,D:h.D,d:h.D,E:h.D},c=.85,l=.501,m=1,d=1.45,p={showMainStickers:!0,showHintStickers:!0,showFoundation:!0},w=new t.MeshBasicMaterial({color:0,opacity:.3,transparent:!0});class CubieDef{constructor(e,i,s){this.orbit=e;const r="string"==typeof i?i.split(""):i;this.stickerFaces=r.map(e=>h[e]),this.matrix=new t.Matrix4,this.matrix.setPosition(g[e]),this.matrix.premultiply((new t.Matrix4).makeRotationFromQuaternion(s))}}function v(e,i){return(new t.Quaternion).setFromAxisAngle(e,r*i/4)}const f={O:new t.Vector3(0,0,0),U:new t.Vector3(0,-1,0),L:new t.Vector3(1,0,0),F:new t.Vector3(0,0,-1),R:new t.Vector3(-1,0,0),B:new t.Vector3(0,0,1),D:new t.Vector3(0,1,0)},g={EDGE:new t.Vector3(0,1,1),CORNER:new t.Vector3(1,1,1),CENTER:new t.Vector3(0,1,0)},D={EDGE:[0,1].map(e=>(new t.Matrix4).makeRotationAxis(g.EDGE.clone().normalize(),-e*r/2)),CORNER:[0,1,2].map(e=>(new t.Matrix4).makeRotationAxis(g.CORNER.clone().normalize(),-e*r/3)),CENTER:[0,1,2,3].map(e=>(new t.Matrix4).makeRotationAxis(g.CENTER.clone().normalize(),-e*r/4))},C=[h.U,h.F,h.R],b={EDGE:[new CubieDef("EDGE","UF",v(f.O,0)),new CubieDef("EDGE","UR",v(f.U,3)),new CubieDef("EDGE","UB",v(f.U,2)),new CubieDef("EDGE","UL",v(f.U,1)),new CubieDef("EDGE","DF",v(f.F,2)),new CubieDef("EDGE","DR",v(f.F,2).premultiply(v(f.D,1))),new CubieDef("EDGE","DB",v(f.F,2).premultiply(v(f.D,2))),new CubieDef("EDGE","DL",v(f.F,2).premultiply(v(f.D,3))),new CubieDef("EDGE","FR",v(f.U,3).premultiply(v(f.R,3))),new CubieDef("EDGE","FL",v(f.U,1).premultiply(v(f.R,3))),new CubieDef("EDGE","BR",v(f.U,3).premultiply(v(f.R,1))),new CubieDef("EDGE","BL",v(f.U,1).premultiply(v(f.R,1)))],CORNER:[new CubieDef("CORNER","UFR",v(f.O,0)),new CubieDef("CORNER","URB",v(f.U,3)),new CubieDef("CORNER","UBL",v(f.U,2)),new CubieDef("CORNER","ULF",v(f.U,1)),new CubieDef("CORNER","DRF",v(f.F,2).premultiply(v(f.D,1))),new CubieDef("CORNER","DFL",v(f.F,2).premultiply(v(f.D,0))),new CubieDef("CORNER","DLB",v(f.F,2).premultiply(v(f.D,3))),new CubieDef("CORNER","DBR",v(f.F,2).premultiply(v(f.D,2)))],CENTER:[new CubieDef("CENTER","U",v(f.O,0)),new CubieDef("CENTER","L",v(f.R,3).premultiply(v(f.U,1))),new CubieDef("CENTER","F",v(f.R,3)),new CubieDef("CENTER","R",v(f.R,3).premultiply(v(f.D,1))),new CubieDef("CENTER","B",v(f.R,3).premultiply(v(f.D,2))),new CubieDef("CENTER","D",v(f.R,2))]};class Cube3D extends Twisty3D{constructor(e,i={}){super(),this.cube=new t.Group,this.pieces={},this.experimentalHintStickerMeshes=[],this.experimentalFoundationMeshes=[],this.options={};for(const e in p)this.options[e]=e in i?i[e]:p[e];if("3x3x3"!==e.name)throw new Error("Invalid puzzle for this Cube3D implementation.");for(const e in b)this.pieces[e]=b[e].map(this.createCubie.bind(this));this.cube.scale.set(1/3,1/3,1/3),this.scene.add(this.cube)}experimentalGetCube(){return this.cube}experimentalUpdateOptions(e){if("showMainStickers"in e)throw new Error("Unimplemented");const t=e.showFoundation;if(void 0!==t&&this.options.showFoundation!==t){this.options.showFoundation=t;for(const e of this.experimentalFoundationMeshes)e.visible=t}const i=e.showHintStickers;if(void 0!==i&&this.options.showHintStickers!==i){this.options.showHintStickers=i;for(const e of this.experimentalHintStickerMeshes)e.visible=i}}updateScene(e){const s=e.state;for(const n in b){const o=b[n];for(let e=0;e<o.length;e++){const t=s[n].permutation[e];this.pieces[n][t].matrix.copy(b[n][e].matrix),this.pieces[n][t].matrix.multiply(D[n][s[n].orientation[e]])}for(const h of e.moves){const e=h.move,c=a[u[e.family]].vector,l=(new t.Matrix4).makeRotationAxis(c,-this.ease(h.fraction)*h.direction*e.amount*r/4);for(let t=0;t<o.length;t++){if(t!==i.Puzzles["3x3x3"].moves[e.family][n].permutation[t]||0!==i.Puzzles["3x3x3"].moves[e.family][n].orientation[t]){const e=s[n].permutation[t];this.pieces[n][e].matrix.premultiply(l)}}}}}createCubie(e){const i=new t.Group;if(this.options.showFoundation){const e=this.createCubieFoundation();i.add(e),this.experimentalFoundationMeshes.push(e)}for(let t=0;t<e.stickerFaces.length;t++)if(i.add(this.createSticker(a[C[t]],a[e.stickerFaces[t]],!1)),this.options.showHintStickers){const s=this.createSticker(a[C[t]],a[e.stickerFaces[t]],!0);i.add(s),this.experimentalHintStickerMeshes.push(s)}return i.matrix.copy(e.matrix),i.matrixAutoUpdate=!1,this.cube.add(i),i}createCubieFoundation(){const e=new t.BoxGeometry(m,m,m);return new t.Mesh(e,w)}createSticker(e,i,s){const r=new t.PlaneGeometry(c,c),n=new t.Mesh(r,s?i.hintStickerMaterial:i.stickerMaterial);return n.setRotationFromEuler(e.fromZ),n.position.copy(e.vector),n.position.multiplyScalar(s?d:l),n}ease(e){return s(e)}}const k=new t.MeshBasicMaterial({side:t.DoubleSide,color:0,transparent:!0,opacity:.75}),x=new t.MeshBasicMaterial({vertexColors:t.FaceColors}),S=new t.MeshBasicMaterial({transparent:!0,opacity:0,color:0});class StickerDef{constructor(e,i){this.origColor=new t.Color(e.color),this.faceColor=new t.Color(e.color),this.cubie=new t.Group,this.geo=new t.Geometry;const s=e.coords,r=[];for(const e of s){const i=new t.Vector3(e[0],e[1],e[2]);r.push(this.geo.vertices.length),this.geo.vertices.push(i)}for(let e=1;e+1<r.length;e++){const i=new t.Face3(r[0],r[e],r[e+1]);i.color=this.faceColor,this.geo.faces.push(i)}this.geo.computeFaceNormals();const n=new t.Mesh(this.geo,x);if(this.cubie.add(n),i){const e=new t.Mesh(this.geo,k);e.scale.setScalar(.99),this.cubie.add(e)}}setColor(e){this.geo.colorsNeedUpdate=!0,this.faceColor.copy(e)}}class HitPlaneDef{constructor(e){this.cubie=new t.Group,this.geo=new t.Geometry;const i=e.coords,s=[];for(const e of i){const i=new t.Vector3(e[0],e[1],e[2]);s.push(this.geo.vertices.length),this.geo.vertices.push(i)}for(let e=1;e+1<s.length;e++){const i=new t.Face3(s[0],s[e],s[e+1]);this.geo.faces.push(i)}this.geo.computeFaceNormals();const r=new t.Mesh(this.geo,S);r.userData.name=e.name,this.cubie.scale.setScalar(.99),this.cubie.add(r)}}class AxisInfo$1{constructor(e){const i=e[0];this.axis=new t.Vector3(i[0],i[1],i[2]),this.order=e[2]}}class PG3D extends Twisty3D{constructor(e,i,s=!1){super(),this.definition=e,this.group=new t.Group,this.stickerTargets=[],this.controlTargets=[],this.axesInfo={};const r=i.axis;for(const e of r)this.axesInfo[e[1]]=new AxisInfo$1(e);const n=i.stickers;this.stickers={};for(const e of n){const t=e.orbit,i=e.ord,r=e.ori;this.stickers[t]||(this.stickers[t]=[]),this.stickers[t][r]||(this.stickers[t][r]=[]);const n=new StickerDef(e,s);n.cubie.scale.set(.5,.5,.5),this.stickers[t][r][i]=n,this.group.add(n.cubie),this.stickerTargets.push(n.cubie.children[0])}const o=i.faces;for(const e of o){const t=new HitPlaneDef(e);t.cubie.scale.set(.5,.5,.5),this.group.add(t.cubie),this.controlTargets.push(t.cubie.children[0])}this.scene.add(this.group)}experimentalGetStickerTargets(){return this.stickerTargets}experimentalGetControlTargets(){return this.controlTargets}experimentalGetGroup(){return this.group}updateScene(s){const n=s.state,o=new t.Euler;for(const e in this.stickers){const t=this.stickers[e],i=n[e],s=t.length;for(let e=0;e<s;e++){const r=t[e];for(let n=0;n<r.length;n++){r[n].cubie.rotation.copy(o);const a=(e+s-i.orientation[n])%s,h=i.permutation[n];r[n].setColor(t[a][h].origColor)}}}const a=new i.KPuzzle(this.definition);for(const t of s.moves){const s=t.move,n=e.modifiedBlockMove(s,{amount:1}),o=a.unswizzle(s.family),h=i.stateForBlockMove(this.definition,n),u=this.axesInfo[o],c=u.axis,l=-this.ease(t.fraction)*t.direction*s.amount*r/u.order;for(const e in this.stickers){const t=this.stickers[e],i=t.length,s=h[e];for(let e=0;e<i;e++){const i=t[e];for(let e=0;e<i.length;e++){s.permutation[e]===e&&0===s.orientation[e]||i[e].cubie.rotateOnAxis(c,l)}}}}}ease(e){return s(e)}}class CountAnimatedMoves extends e.TraversalUp{traverseSequence(e){let t=0;for(const i of e.nestedUnits)t+=this.traverse(i);return t}traverseGroup(e){return this.traverseSequence(e.nestedSequence)}traverseBlockMove(e){return 1}traverseCommutator(e){return 2*(this.traverseSequence(e.A)+this.traverseSequence(e.B))}traverseConjugate(e){return 2*this.traverseSequence(e.A)+this.traverseSequence(e.B)}traversePause(e){return 0}traverseNewLine(e){return 0}traverseCommentShort(e){return 0}traverseCommentLong(e){return 0}}class AlgPartDecoration{constructor(e,t,i,s,r,n=[]){this.moveCount=t,this.duration=i,this.forward=s,this.backward=r,this.children=n}}class DecoratorConstructor extends e.TraversalUp{constructor(e){super(),this.puz=e,this.durationFn=new Cursor.AlgDuration(Cursor.DefaultDurationForAmount),this.identity=e.identity(),this.dummyLeaf=new AlgPartDecoration(e,0,0,this.identity,this.identity,[])}traverseSequence(e){let t=0,i=0,s=this.identity;const r=[];for(const n of e.nestedUnits){const e=this.traverse(n);t+=e.moveCount,i+=e.duration,s=this.puz.combine(s,e.forward),r.push(e)}return new AlgPartDecoration(this.puz,t,i,s,this.puz.invert(s),r)}traverseGroup(e){const t=this.traverseSequence(e.nestedSequence);return this.mult(t,e.amount,[t])}traverseBlockMove(e){return new AlgPartDecoration(this.puz,1,this.durationFn.traverse(e),this.puz.stateFromMove(e),this.puz.stateFromMove(T(e)))}traverseCommutator(e){const t=this.traverseSequence(e.A),i=this.traverseSequence(e.B),s=this.puz.combine(t.forward,i.forward),r=this.puz.combine(t.backward,i.backward),n=this.puz.combine(s,r),o=new AlgPartDecoration(this.puz,2*(t.moveCount+i.moveCount),2*(t.duration+i.duration),n,this.puz.invert(n),[t,i]);return this.mult(o,e.amount,[o,t,i])}traverseConjugate(e){const t=this.traverseSequence(e.A),i=this.traverseSequence(e.B),s=this.puz.combine(t.forward,i.forward),r=this.puz.combine(s,t.backward),n=new AlgPartDecoration(this.puz,2*t.moveCount+i.moveCount,2*t.duration+i.duration,r,this.puz.invert(r),[t,i]);return this.mult(n,e.amount,[n,t,i])}traversePause(e){return new AlgPartDecoration(this.puz,1,this.durationFn.traverse(e),this.identity,this.identity)}traverseNewLine(e){return this.dummyLeaf}traverseCommentShort(e){return this.dummyLeaf}traverseCommentLong(e){return this.dummyLeaf}mult(e,t,i){const s=Math.abs(t),r=this.puz.multiply(e.forward,t);return new AlgPartDecoration(this.puz,e.moveCount*s,e.duration*s,r,this.puz.invert(r),i)}}class WalkerDown{constructor(e,t){this.apd=e,this.back=t}}class AlgWalker extends e.TraversalDownUp{constructor(e,t,i){super(),this.puz=e,this.alg=t,this.apd=i,this.i=-1,this.dur=-1,this.goali=-1,this.goaldur=-1,this.mv=void 0,this.back=!1,this.moveDur=0,this.st=this.puz.identity(),this.root=new WalkerDown(this.apd,!1)}moveByIndex(e){return this.i>=0&&this.i===e?void 0!==this.mv:this.dosearch(e,1/0)}moveByDuration(e){return this.dur>=0&&this.dur<e&&this.dur+this.moveDur>=e?void 0!==this.mv:this.dosearch(1/0,e)}dosearch(e,t){return this.goali=e,this.goaldur=t,this.i=0,this.dur=0,this.mv=void 0,this.moveDur=0,this.back=!1,this.st=this.puz.identity(),this.traverse(this.alg,this.root)}traverseSequence(e,t){if(!this.firstcheck(t))return!1;if(t.back)for(let i=e.nestedUnits.length-1;i>=0;i--){const s=e.nestedUnits[i];if(this.traverse(s,new WalkerDown(t.apd.children[i],t.back)))return!0}else for(let i=0;i<e.nestedUnits.length;i++){const s=e.nestedUnits[i];if(this.traverse(s,new WalkerDown(t.apd.children[i],t.back)))return!0}return!1}traverseGroup(e,t){if(!this.firstcheck(t))return!1;const i=this.domult(t,e.amount);return this.traverse(e.nestedSequence,new WalkerDown(t.apd.children[0],i))}traverseBlockMove(e,t){return!!this.firstcheck(t)&&(this.mv=e,this.moveDur=t.apd.duration,this.back=t.back,!0)}traverseCommutator(e,t){if(!this.firstcheck(t))return!1;const i=this.domult(t,e.amount);return i?this.traverse(e.B,new WalkerDown(t.apd.children[2],!i))||this.traverse(e.A,new WalkerDown(t.apd.children[1],!i))||this.traverse(e.B,new WalkerDown(t.apd.children[2],i))||this.traverse(e.A,new WalkerDown(t.apd.children[1],i)):this.traverse(e.A,new WalkerDown(t.apd.children[1],i))||this.traverse(e.B,new WalkerDown(t.apd.children[2],i))||this.traverse(e.A,new WalkerDown(t.apd.children[1],!i))||this.traverse(e.B,new WalkerDown(t.apd.children[2],!i))}traverseConjugate(e,t){if(!this.firstcheck(t))return!1;const i=this.domult(t,e.amount);return i?this.traverse(e.A,new WalkerDown(t.apd.children[1],!i))||this.traverse(e.B,new WalkerDown(t.apd.children[2],i))||this.traverse(e.A,new WalkerDown(t.apd.children[1],i)):this.traverse(e.A,new WalkerDown(t.apd.children[1],i))||this.traverse(e.B,new WalkerDown(t.apd.children[2],i))||this.traverse(e.A,new WalkerDown(t.apd.children[1],!i))}traversePause(e,t){return!!this.firstcheck(t)&&(this.mv=e,this.moveDur=t.apd.duration,this.back=t.back,!0)}traverseNewLine(e,t){return!1}traverseCommentShort(e,t){return!1}traverseCommentLong(e,t){return!1}firstcheck(e){return!(e.apd.moveCount+this.i<=this.goali&&e.apd.duration+this.dur<this.goaldur)||this.keepgoing(e)}domult(e,t){let i=e.back;if(0===t)return i;t<0&&(i=!i,t=-t);const s=e.apd.children[0],r=Math.min(Math.floor((this.goali-this.i)/s.moveCount),Math.ceil((this.goaldur-this.dur)/s.duration-1));return r>0&&this.keepgoing(new WalkerDown(s,i),r),i}keepgoing(e,t=1){return this.i+=t*e.apd.moveCount,this.dur+=t*e.apd.duration,1!==t?e.back?this.st=this.puz.combine(this.st,this.puz.multiply(e.apd.backward,t)):this.st=this.puz.combine(this.st,this.puz.multiply(e.apd.forward,t)):e.back?this.st=this.puz.combine(this.st,e.apd.backward):this.st=this.puz.combine(this.st,e.apd.forward),!1}}function T(t){return new e.BlockMove(t.outerLayer,t.innerLayer,t.family,-t.amount)}class TreeAlgorithmIndexer{constructor(e,t){this.puzzle=e;const i=new DecoratorConstructor(this.puzzle);this.decoration=i.traverse(t),this.walker=new AlgWalker(this.puzzle,t,this.decoration)}getMove(e){if(this.walker.moveByIndex(e)){const e=this.walker.mv;return this.walker.back?T(e):e}throw new Error("Out of algorithm: index "+e)}indexToMoveStartTimestamp(e){if(this.walker.moveByIndex(e)||this.walker.i===e)return this.walker.dur;throw new Error("Out of algorithm: index "+e)}stateAtIndex(e){return this.walker.moveByIndex(e),this.puzzle.combine(this.puzzle.startState(),this.walker.st)}transformAtIndex(e){return this.walker.moveByIndex(e),this.walker.st}numMoves(){return this.decoration.moveCount}timestampToIndex(e){return this.walker.moveByDuration(e),this.walker.i}algDuration(){return this.decoration.duration}moveDuration(e){return this.walker.moveByIndex(e),this.walker.moveDur}}const y=new CountAnimatedMoves;y.traverse.bind(y);class SingleAnimatedMove{constructor(e,t){this.priorState=e,this.move=t,this.moveDuration=Cursor.DefaultDurationForAmount(this.move.amount),this.algTimestamp=0}doLastMoveDelta(e){return this.algTimestamp+=e,this.algTimestamp<0||this.algTimestamp>=this.moveDuration}}class Cursor{constructor(e,t){this.alg=e,this.puzzle=t,this.setMoves(e),this.setPositionToStart()}experimentalSetMoves(e){return this.setMoves(e)}experimentalUpdateAlgAnimate(e,t){const i=this.indexer.stateAtIndex(this.indexer.numMoves());this.setMoves(e),this.lastMoveData=new SingleAnimatedMove(i,t)}setPositionToStart(){this.lastMoveData=void 0,this.algTimestamp=0}setPositionToEnd(){this.lastMoveData=void 0,this.setPositionToStart(),this.forward(this.endOfAlg(),!1)}startOfAlg(){return 0}endOfAlg(){return this.indexer.algDuration()}currentPosition(){if(this.lastMoveData){const e={state:this.lastMoveData.priorState,moves:[]},t=this.lastMoveData.move,i=this.lastMoveData.algTimestamp;return 0!==i&&e.moves.push({move:t,direction:Cursor.Direction.Forwards,fraction:i/this.lastMoveData.moveDuration}),e}const e=this.indexer.timestampToIndex(this.algTimestamp),t={state:this.indexer.stateAtIndex(e),moves:[]};if(0===this.indexer.numMoves())return t;const i=this.indexer.getMove(e),s=this.algTimestamp-this.indexer.indexToMoveStartTimestamp(e),r=this.indexer.indexToMoveStartTimestamp(e+1)-this.indexer.indexToMoveStartTimestamp(e);return 0!==s&&t.moves.push({move:i,direction:Cursor.Direction.Forwards,fraction:s/r}),t}currentTimestamp(){return this.algTimestamp}delta(e,t){if(this.lastMoveData){if(!this.lastMoveData.doLastMoveDelta(e))return!1;this.lastMoveData=void 0,e=1e30,this.algTimestamp=this.indexer.algDuration()}const i=this.indexer.timestampToIndex(this.algTimestamp),s=this.algTimestamp+e,r=this.indexer.indexToMoveStartTimestamp(i);if(t){if(s<r)return this.algTimestamp=r,!0;const e=r+this.indexer.moveDuration(i);if(s>e)return this.algTimestamp=e,!0}return this.algTimestamp=Math.max(0,Math.min(this.indexer.algDuration(),s)),this.algTimestamp===this.indexer.algDuration()}experimentalSetDurationScale(e){}forward(e,t){return this.delta(e,t)}backward(e,t){return this.delta(-e,t)}setMoves(e){this.lastMoveData=void 0,this.indexer=new TreeAlgorithmIndexer(this.puzzle,e)}}!function(t){let i,s;function r(e){switch(Math.abs(e)){case 0:return 0;case 1:return 1e3;case 2:return 1500;default:return 2e3}}!function(e){e[e.Forwards=1]="Forwards",e[e.Paused=0]="Paused",e[e.Backwards=-1]="Backwards"}(i=t.Direction||(t.Direction={})),function(e){e[e.Move=0]="Move",e[e.EntireMoveSequence=1]="EntireMoveSequence"}(s=t.BreakpointType||(t.BreakpointType={})),t.ConstantDurationForAmount=function(e){return 1e3},t.DefaultDurationForAmount=r,t.ExperimentalScaledDefaultDurationForAmount=function(e,t){switch(Math.abs(t)){case 0:return 0;case 1:return 1e3*e;case 2:return 1500*e;default:return 2e3*e}};class AlgDuration extends e.TraversalUp{constructor(e=r){super(),this.durationForAmount=e}traverseSequence(e){let t=0;for(const i of e.nestedUnits)t+=this.traverse(i);return t}traverseGroup(e){return e.amount*this.traverse(e.nestedSequence)}traverseBlockMove(e){return this.durationForAmount(e.amount)}traverseCommutator(e){return 2*e.amount*(this.traverse(e.A)+this.traverse(e.B))}traverseConjugate(e){return e.amount*(2*this.traverse(e.A)+this.traverse(e.B))}traversePause(e){return this.durationForAmount(1)}traverseNewLine(e){return this.durationForAmount(1)}traverseCommentShort(e){return this.durationForAmount(0)}traverseCommentLong(e){return this.durationForAmount(0)}}t.AlgDuration=AlgDuration}(Cursor||(Cursor={}));class KSolvePuzzle extends class Puzzle{multiply(e,t){if(t<0)return this.invert(this.multiply(e,-t));let i=this.identity();for(;t>0;)t%2==1&&(i=this.combine(i,e)),t=Math.floor(t/2),e=this.combine(e,e);return i}}{constructor(e){super(),this.definition=e,this.moveStash={}}static fromID(e){return new KSolvePuzzle(i.Puzzles[e])}startState(){return this.definition.startPieces}invert(e){return i.Invert(this.definition,e)}combine(e,t){return i.Combine(this.definition,e,t)}stateFromMove(t){const s=e.blockMoveToString(t);return this.moveStash[s]||(this.moveStash[s]=i.stateForBlockMove(this.definition,t)),this.moveStash[s]}identity(){return i.IdentityTransformation(this.definition)}equivalent(e,t){return i.EquivalentStates(this.definition,e,t)}}function F(e,t){const i=e.family[0].toLowerCase()+t.family[0].toLowerCase();return-1!==["uu","ud","du","dd","ll","lr","rl","rr","ff","fb","bf","bb"].indexOf(i)}function M(t,i=200){return function(t,i){const s=[],r=new Map;let n=null;for(const o of t){if(!n){n={event:o,start:o.timeStamp-i/2,end:o.timeStamp+i/2},s.push([n]),r.set(e.experimentalBlockMoveQuantumName(n.event.move),n);continue}const t={event:o,start:o.timeStamp-i/2,end:o.timeStamp+i/2};if(F(n.event.move,o.move)){const i=e.experimentalBlockMoveQuantumName(t.event.move),n=r.get(i);n&&n.end>t.start&&Math.sign(n.event.move.amount)===Math.sign(t.event.move.amount)?n.event.move=new e.BlockMove(n.event.move.outerLayer,n.event.move.innerLayer,n.event.move.family,n.event.move.amount+t.event.move.amount):(s[s.length-1].push(t),r.set(i,t))}else if(s.push([t]),r.clear(),r.set(e.experimentalBlockMoveQuantumName(t.event.move),t),t.start<n.end){const e=(t.start+n.end)/2;t.start=e,n.end=e}n=t}return s}(t,i).flat()}class Dispatcher{constructor(){this.cursorObservers=new Set,this.directionObservers=new Set,this.jumpObservers=new Set}registerCursorObserver(e){if(this.cursorObservers.has(e))throw new Error("Duplicate cursor observer added.");this.cursorObservers.add(e)}registerDirectionObserver(e){if(this.directionObservers.has(e))throw new Error("Duplicate direction observer added.");this.directionObservers.add(e)}registerJumpObserver(e){if(this.jumpObservers.has(e))throw new Error("Duplicate direction observer added.");this.jumpObservers.add(e)}animCursorChanged(e){for(const t of this.cursorObservers)t.animCursorChanged(e)}animDirectionChanged(e){for(const t of this.directionObservers)t.animDirectionChanged(e)}animCursorJumped(){for(const e of this.jumpObservers)e.animCursorJumped()}}class AnimModel{constructor(e){this.cursor=e,this.dispatcher=new Dispatcher,this.lastCursorTime=0,this.direction=Cursor.Direction.Paused,this.breakpointType=Cursor.BreakpointType.EntireMoveSequence,this.tempo=1.5,this.scheduler=new FrameScheduler(this.frame.bind(this))}experimentalGetScheduler(){return this.scheduler}getBounds(){return[this.cursor.startOfAlg(),this.cursor.endOfAlg()]}isPaused(){return this.direction===Cursor.Direction.Paused}skipAndPauseTo(e){this.pause(),this.cursor.setPositionToStart(),this.cursor.forward(e,!1),this.scheduler.singleFrame()}playForward(){this.setBreakpointType(Cursor.BreakpointType.EntireMoveSequence),this.animateDirection(Cursor.Direction.Forwards)}pause(){this.animateDirection(Cursor.Direction.Paused)}playBackward(){this.setBreakpointType(Cursor.BreakpointType.EntireMoveSequence),this.animateDirection(Cursor.Direction.Backwards)}skipToStart(){this.skipAndPauseTo(this.cursor.startOfAlg()),this.dispatcher.animCursorJumped()}skipToEnd(){this.skipAndPauseTo(this.cursor.endOfAlg()),this.dispatcher.animCursorJumped()}isAtEnd(){return this.cursor.currentTimestamp()===this.cursor.endOfAlg()}stepForward(){this.cursor.forward(.1,!1),this.setBreakpointType(Cursor.BreakpointType.Move),this.animateDirection(Cursor.Direction.Forwards)}stepBackward(){this.cursor.backward(.1,!1),this.setBreakpointType(Cursor.BreakpointType.Move),this.animateDirection(Cursor.Direction.Backwards)}togglePausePlayForward(){this.isPaused()?this.playForward():this.pause()}timeScaling(){return this.direction*this.tempo}updateCursor(e){if(this.direction===Cursor.Direction.Paused)return void(this.lastCursorTime=e);let t=e-this.lastCursorTime;this.lastCursorTime=e,t<0&&(t=0),this.cursor.delta(t*this.timeScaling(),this.breakpointType===Cursor.BreakpointType.Move)&&(this.setDirection(Cursor.Direction.Paused),this.scheduler.stop())}setDirection(e){this.direction=e,this.dispatcher.animDirectionChanged(e)}frame(e){this.updateCursor(e),this.dispatcher.animCursorChanged(this.cursor)}setBreakpointType(e){this.breakpointType=e}animateDirection(e){this.direction!==e&&(this.updateCursor(performance.now()),this.setDirection(e),e===Cursor.Direction.Paused?this.scheduler.stop():this.scheduler.start())}}class FrameScheduler{constructor(e){this.callback=e,this.animating=!1,this.lastRenderTimestamp=-1}animFrame(e){e!==this.lastRenderTimestamp&&(this.lastRenderTimestamp=e,this.callback(e)),this.animating&&requestAnimationFrame(this.animFrame.bind(this))}start(){this.animating||(this.animating=!0,requestAnimationFrame(this.animFrame.bind(this)))}stop(){this.animating=!1}singleFrame(){this.start(),this.stop()}}let E=!0;function A(e){E=e}class Button{constructor(e,t){this.element=document.createElement("button"),this.element.title=e,this.element.classList.add(t),this.element.addEventListener("click",this.onpress.bind(this))}}!function(e){e.Fullscreen=class Fullscreen extends e{constructor(e){super("Full Screen","fullscreen"),this.fullscreenElement=e}onpress(){var e;(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement)===this.fullscreenElement?(document.exitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitExitFullscreen).call(document):((e=this.fullscreenElement).requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullscreen).call(e)}};e.SkipToStart=class SkipToStart extends e{constructor(e){super("Skip To Start","skip-to-start"),this.anim=e}onpress(){this.anim.skipToStart()}};e.SkipToEnd=class SkipToEnd extends e{constructor(e){super("Skip To End","skip-to-end"),this.anim=e}onpress(){this.anim.skipToEnd()}};e.PlayPause=class PlayPause extends e{constructor(e){super("Play","play"),this.anim=e,this.anim.dispatcher.registerDirectionObserver(this)}onpress(){this.anim.isPaused()&&this.anim.isAtEnd()&&this.anim.skipToStart(),this.anim.togglePausePlayForward()}animDirectionChanged(e){const t=e===Cursor.Direction.Paused?"play":"pause";this.element.classList.remove("play","pause"),this.element.classList.add(t),this.element.title=e===Cursor.Direction.Paused?"Play":"Pause"}};e.StepForward=class StepForward extends e{constructor(e){super("Step forward","step-forward"),this.anim=e}onpress(){this.anim.stepForward()}};e.StepBackward=class StepBackward extends e{constructor(e){super("Step backward","step-backward"),this.anim=e}onpress(){this.anim.stepBackward()}}}(Button||(Button={}));class ControlBar{constructor(e,t){this.element=document.createElement("twisty-control-bar"),this.element.appendChild(new Button.Fullscreen(t).element),this.element.appendChild(new Button.SkipToStart(e).element),this.element.appendChild(new Button.StepBackward(e).element),this.element.appendChild(new Button.PlayPause(e).element),this.element.appendChild(new Button.StepForward(e).element),this.element.appendChild(new Button.SkipToEnd(e).element)}}class Scrubber{constructor(e){this.anim=e,this.element=document.createElement("input"),this.element.classList.add("scrubber"),this.element.type="range",this.element.addEventListener("input",this.oninput.bind(this)),this.updateFromAnim(),this.anim.dispatcher.registerCursorObserver(this)}updateFromAnim(){const e=this.anim.getBounds();this.element.min=String(e[0]),this.element.max=String(e[1]),this.element.value=String(this.anim.cursor.currentTimestamp())}animCursorChanged(e){this.element.value=String(e.currentTimestamp()),this.updateBackground()}animBoundsChanged(){this.updateBackground()}updateBackground(){const e=parseInt(this.element.min,10),t=parseInt(this.element.max,10),i=(parseInt(this.element.value,10)-e)/t*100;this.element.style.background=`linear-gradient(to right,       rgb(0, 63, 255) 0%,       rgb(0, 63, 255) ${i}%,       rgba(0, 0, 0, 0.25) ${i}%,       rgba(0, 0, 0, 0.25) 100%      )`}oninput(){this.anim.skipAndPauseTo(parseInt(this.element.value,10)),this.updateBackground()}}class CursorTextMoveView{constructor(e){this.anim=e,this.element=document.createElement("cursor-text-view"),this.anim.dispatcher.registerCursorObserver(this),this.animCursorChanged(e.cursor)}animCursorChanged(t){const i=t.currentPosition();let s=""+Math.floor(t.currentTimestamp());i.moves.length>0&&(s+=" "+e.algToString(new e.Sequence([i.moves[0].move]))+" "+this.formatFraction(i.moves[0].fraction)),this.element.textContent=s}formatFraction(e){return(String(e)+(Math.floor(e)===e?".":"")+"000000").slice(0,5)}}class KSolveView{constructor(e,t){this.anim=e,this.definition=t,this.element=document.createElement("ksolve-svg-view"),this.anim.dispatcher.registerCursorObserver(this),this.anim.dispatcher.registerJumpObserver(this),this.svg=new i.SVG(t),this.element.appendChild(this.svg.element)}animCursorChanged(t){const s=t.currentPosition();if(s.moves.length>0){const t=s.moves[0].move,r=this.definition,n=new e.BlockMove(t.outerLayer,t.innerLayer,t.family,t.amount*s.moves[0].direction),o=i.Combine(r,s.state,i.stateForBlockMove(r,n));this.svg.draw(this.definition,s.state,o,s.moves[0].fraction)}else this.svg.draw(this.definition,s.state)}animCursorJumped(){E&&(this.element.classList.add("flash"),setTimeout(()=>this.element.classList.remove("flash"),0))}}class Cube3DView{constructor(e,t,i={}){var s;this.anim=e,this.config=i,this.element=document.createElement("cube3d-view"),this.element.tabIndex=0,this.anim.dispatcher.registerCursorObserver(this),this.anim.dispatcher.registerJumpObserver(this),this.cube3D=new Cube3D(t);const r=document.createElement("cube3d-wrapper");r.classList.add("front"),this.element.appendChild(r),setTimeout(()=>{this.cube3D.newVantage(r)},0),null!==(s=this.config.experimentalShowBackView)&&void 0!==s&&s&&this.createBackViewForTesting()}createBackViewForTesting(){const e=document.createElement("cube3d-wrapper");e.classList.add("back"),this.element.appendChild(e),setTimeout(()=>{this.cube3D.newVantage(e,{position:new t.Vector3(-1.25,-2.5,-2.5)})},0)}animCursorChanged(e){this.cube3D.draw(e.currentPosition())}animCursorJumped(){E&&(this.element.classList.add("flash"),setTimeout(()=>this.element.classList.remove("flash"),0))}experimentalGetCube3D(){return this.cube3D}}class PG3DView{constructor(e,i,s){var r,n;this.anim=e,this.definition=i,this.config=s,this.element=document.createElement("cube3d-view"),null!==(r=this.config.sideBySide)&&void 0!==r&&r&&this.element.classList.add("side-by-side");const o=document.createElement("cube3d-wrapper");o.classList.add("front"),this.element.appendChild(o),this.anim.dispatcher.registerCursorObserver(this),this.anim.dispatcher.registerJumpObserver(this),this.pg3D=new PG3D(this.definition,this.config.stickerDat,null!==(n=this.config.showFoundation)&&void 0!==n&&n),setTimeout(()=>{const e=this.config.experimentalPolarVantages?new t.Vector3(0,0,-5.5):new t.Vector3(0,-4.4,-4.4);this.pg3D.newVantage(o,{position:e,shift:this.config.sideBySide?-1:0})},0),this.createBackViewForTesting()}animCursorChanged(e){this.pg3D.draw(e.currentPosition())}animCursorJumped(){E&&(this.element.classList.add("flash"),setTimeout(()=>this.element.classList.remove("flash"),0))}experimentalGetPG3D(){return this.pg3D}createBackViewForTesting(){const e=document.createElement("cube3d-wrapper");e.classList.add("back"),this.element.appendChild(e),setTimeout(()=>{const i=this.config.experimentalPolarVantages?new t.Vector3(0,0,5.5):new t.Vector3(0,4.4,4.4);this.pg3D.newVantage(e,{position:i,shift:this.config.sideBySide?1:0})},0)}}class Player{constructor(e,t,i={}){var s;this.anim=e,this.config=i,this.element=document.createElement("player"),"PG3D"===this.config.visualizationFormat?this.element.appendChild((this.pg3DView=new PG3DView(this.anim,t,i.experimentalPG3DViewConfig)).element):"3D"===this.config.visualizationFormat?"3x3x3"===t.name?this.element.appendChild((this.cube3DView=new Cube3DView(this.anim,t,this.config.experimentalCube3DViewConfig)).element):(console.warn(`3D visualization specified for unsupported puzzle: ${t.name}. Falling back to 2D.`),this.element.appendChild(new KSolveView(this.anim,t).element)):this.config.visualizationFormat||"3x3x3"!==t.name?this.element.appendChild(new KSolveView(this.anim,t).element):this.element.appendChild((this.cube3DView=new Cube3DView(this.anim,t,this.config.experimentalCube3DViewConfig)).element),this.scrubber=new Scrubber(this.anim),(null===(s=this.config.experimentalShowControls)||void 0===s||s)&&(this.element.appendChild(this.scrubber.element),this.element.appendChild(new ControlBar(this.anim,this.element).element),this.element.appendChild(new CursorTextMoveView(this.anim).element))}updateFromAnim(){this.scrubber.updateFromAnim()}}class TwistyParams{}class Twisty{constructor(t,s={}){this.element=t,this.alg=s.alg||e.Example.Niklas,this.puzzleDef=s.puzzle||i.Puzzles["3x3x3"],this.cursor=new Cursor(this.alg,new KSolvePuzzle(this.puzzleDef)),this.anim=new AnimModel(this.cursor),this.player=new Player(this.anim,this.puzzleDef,s.playerConfig),this.element.appendChild(this.player.element),this.coalesceModFunc=e=>0}setCoalesceModFunc(e){this.coalesceModFunc=e}experimentalSetAlg(e,t=!1){this.cursor.experimentalSetMoves(e),this.anim.skipToStart(),this.alg=e,this.anim.skipToEnd(),this.player.updateFromAnim(),t&&this.anim.cursor.currentTimestamp()>0&&(this.cursor.backward(.01,!1),this.cursor.backward(1e5,!0),this.anim.stepForward())}experimentalSetAlgAnimateBlockMove(e,t){this.anim.skipToStart(),this.alg=e,this.anim.skipToEnd(),this.cursor.experimentalUpdateAlgAnimate(e,t),this.player.updateFromAnim(),this.anim.stepForward()}experimentalAddMove(t){const i=this.coalesceModFunc(t),s=e.experimentalAppendBlockMove(this.alg,t,!0,i);this.experimentalSetAlgAnimateBlockMove(s,t)}experimentalGetAnim(){return this.anim}experimentalGetPlayer(){return this.player}experimentalGetCursor(){return this.cursor}}function z(t){const s=t.getAttribute("initialization"),r=function(t){const s=new TwistyParams,r=t.getAttribute("puzzle");r&&(s.puzzle=i.Puzzles[r]);const n=t.getAttribute("alg");n&&(s.alg=e.parse(n));const o=t.getAttribute("visualization");return o&&("2D"===o||"3D"===o||"PG3D"===o?s.playerConfig={visualizationFormat:o}:console.warn(`Invalid visualization: ${o}`)),s}(t);return"custom"!==s?new Twisty(t,r):null}"undefined"!=typeof window&&window.addEventListener("load",(function(){const e=document.querySelectorAll("twisty");e.length>0&&console.log(`Found ${e.length} twisty elem${1===e.length?"":"s"} on page.`),e.forEach(z)}));var B=Object.freeze({__proto__:null,Cube3D:Cube3D,PG3D:PG3D,TAU:r,Vantage:Vantage,TreeAlgorithmIndexer:TreeAlgorithmIndexer,KSolvePuzzle:KSolvePuzzle,toTimeline:M,Twisty:Twisty,TwistyParams:TwistyParams,experimentalShowJumpingFlash:A});exports.Cube3D=Cube3D,exports.KSolvePuzzle=KSolvePuzzle,exports.PG3D=PG3D,exports.TAU=r,exports.TreeAlgorithmIndexer=TreeAlgorithmIndexer,exports.Twisty=Twisty,exports.TwistyParams=TwistyParams,exports.Vantage=Vantage,exports.experimentalShowJumpingFlash=A,exports.index=B,exports.toTimeline=M;
//# sourceMappingURL=index-7e411523.js.map
